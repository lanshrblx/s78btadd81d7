local function findCurrentEntity(PlayerName)
    local Fsys = require(game.ReplicatedStorage.Fsys)
    local PetEntityManager = Fsys.load("PetEntityManager")
    local CharWrapperClient = Fsys.load("CharWrapperClient")
    local currentEntity = 0
    CharWrapperClient.register_pet_wrapper_char_changed(function(oldPets, newPets, allPets)
        for _, petWrapper in ipairs(newPets) do
            currentEntity = PetEntityManager.get_local_owned_pet_entities(PlayerName)[1]
        end
    end)
    return currentEntity
end

local plr = game:GetService("Players").LocalPlayer
local targetPet = findCurrentEntity(plr)

local function directPetting(petEntity)
    local PetEntityHelper = require(game.ReplicatedStorage.Fsys).load("PetEntityHelper")
    local RunService = game:GetService("RunService")
    local mouse = game.Players.LocalPlayer:GetMouse()
    
    local isActive = true
    local petModel = workspace.Pets:FindFirstChild("Cat") -- –ù–∞–π–¥–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –º–æ–¥–µ–ª—å –ø–∏—Ç–æ–º—Ü–∞

    -- 1. –ù–∞—á–∞–ª–æ –ø–æ–≥–ª–∞–∂–∏–≤–∞–Ω–∏—è - —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä—Ñ–æ—Ä–º–∞–Ω—Å—ã
    if petModel then
        local args1 = {
            petModel,
            {
                FocusPet = true,
                Petting = true,
                Dirty = true
            }
        }
        game:GetService("ReplicatedStorage").API["PetAPI/ReplicateActivePerformances"]:FireServer(unpack(args1))
    end

    -- –ó–∞–ø—É—Å–∫–∞–µ–º –ø–æ–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ (—ç—Ç–æ –∑–∞–ø—É—Å–∫–∞–µ—Ç –∞–Ω–∏–º–∞—Ü–∏—é)
    PetEntityHelper.stage_performance(petEntity, {
        name = "Petting",
        options = {
            update_petting = function()
                if not isActive then
                    return nil, false
                end
                return Vector2.new(mouse.X, mouse.Y), true
            end
        }
    })
    
    -- –ñ–¥–µ–º 2 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏
    wait(2)
    
    -- 2. –ü–µ—Ä–µ—Ö–æ–¥ –≤ —Å—á–∞—Å—Ç–ª–∏–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    if petModel then
        local args2 = {
            petModel,
            {
                FocusPet = true,
                PettingHappy = true,  -- –ú–µ–Ω—è–µ–º –Ω–∞ PettingHappy
                Dirty = true
            }
        }
        game:GetService("ReplicatedStorage").API["PetAPI/ReplicateActivePerformances"]:FireServer(unpack(args2))
    end
    
    -- –ñ–¥–µ–º –µ—â–µ 1 —Å–µ–∫—É–Ω–¥—É
    wait(1)
    
    -- –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–æ–≥–ª–∞–∂–∏–≤–∞–Ω–∏–µ
    isActive = false
    PetEntityHelper.end_performance(petEntity, "Petting")
    
    -- 3. –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø–æ–≥–ª–∞–∂–∏–≤–∞–Ω–∏—è
    if petModel then
        local args3 = {
            petModel,
            {
                FocusPet = true,
                Dirty = true  -- –£–±–∏—Ä–∞–µ–º Petting –∏ PettingHappy
            }
        }
        game:GetService("ReplicatedStorage").API["PetAPI/ReplicateActivePerformances"]:FireServer(unpack(args3))
    end
    
    -- 4. üî• –í–´–ó–´–í–ê–ï–ú PetPetted –î–õ–Ø –ó–ê–î–ê–ù–ò–Ø
    local args4 = {
        "2_a91f4904f09e4824ad7ff24dc38df4ea",
        game:GetService("Players").LocalPlayer
    }
    game:GetService("ReplicatedStorage").API["PetAPI/PetPetted"]:FireServer(unpack(args4))
    
    print("Petting completed! Quest should be updated.")
end

-- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
directPetting(targetPet)
